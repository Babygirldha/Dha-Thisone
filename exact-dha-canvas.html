<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DHA-802 Exact Replica Using Template</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #2a2a2a;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            margin: 20px 0;
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
            background: white;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            padding: 12px 24px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 0 10px;
        }
        button:hover {
            background: #218838;
        }
        h1 {
            color: #fff;
            margin: 20px 0 10px 0;
        }
        p {
            color: #ccc;
        }
    </style>
</head>
<body>
    <h1>DHA-802 Permanent Residence Permit - Exact Template</h1>
    <p>Using official template with dynamic personal details</p>
    
    <div class="controls">
        <button onclick="generatePRP('Muhammad Mohsin', 'AD0116281', 'PRP361176/2023 DRN')">Muhammad Mohsin</button>
        <button onclick="generatePRP('Tasleem Mohsin', 'AUD115281', 'PRP361177/2023 DRN')">Tasleem Mohsin</button>
        <button onclick="generatePRP('Khunsha', 'KV4122911', 'PRP361178/2023 DRN')">Khunsha</button>
        <button onclick="downloadCanvas()">Download as Image</button>
    </div>
    
    <canvas id="prpCanvas" width="2100" height="2970"></canvas>

    <script>
        const canvas = document.getElementById('prpCanvas');
        const ctx = canvas.getContext('2d');
        
        // Set canvas display size
        canvas.style.width = '700px';
        canvas.style.height = '990px';
        
        // Load the reference template image
        const templateImage = new Image();
        templateImage.src = 'attached_assets/Untitled (A4).zip - 1_1759004195075.png';
        
        templateImage.onload = function() {
            console.log('Template loaded successfully');
            // Generate first document on load
            generatePRP('Muhammad Mohsin', 'AD0116281', 'PRP361176/2023 DRN');
        };
        
        templateImage.onerror = function() {
            console.error('Failed to load template image');
            // Fallback to blank document
            ctx.fillStyle = '#F8F5F0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#000';
            ctx.font = '60px Arial';
            ctx.fillText('Template image not found', 500, 500);
        };
        
        function generatePRP(name, referenceNo, permitNumber) {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw the template image as background
            if (templateImage.complete && templateImage.naturalHeight !== 0) {
                ctx.drawImage(templateImage, 0, 0, canvas.width, canvas.height);
            } else {
                // If image not loaded, use cream background
                ctx.fillStyle = '#F8F5F0';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            // Set font for dynamic text
            ctx.fillStyle = '#000';
            ctx.font = '52px Arial';
            
            // DYNAMIC FIELDS - positioned exactly over the template
            // These positions are carefully measured from the reference image
            
            // Permit Number (left field at top)
            ctx.fillText(permitNumber, 520, 570);
            
            // Reference Number (right field at top)  
            ctx.fillText(referenceNo, 1450, 570);
            
            // Parse name
            const [firstName, ...lastNames] = name.split(' ');
            const surname = lastNames.join(' ').toUpperCase();
            const firstNameUpper = firstName.toUpperCase();
            
            // Surname
            ctx.fillText(surname, 420, 810);
            
            // First Name(s)
            ctx.fillText(firstNameUpper, 450, 1015);
            
            // Nationality (hardcoded as PAKISTANI for these examples)
            ctx.fillText('PAKISTANI', 420, 1115);
            
            // Date of birth (example dates)
            let birthDate = '1985/05/21';
            if (name.includes('Tasleem')) birthDate = '1987/03/15';
            if (name.includes('Khunsha')) birthDate = '1990/08/10';
            ctx.fillText(birthDate, 470, 1215);
            
            // Gender
            const gender = name.includes('Khunsha') ? 'FEMALE' : 'MALE';
            ctx.fillText(gender, 1150, 1215);
            
            // Permit expiry date (in the paragraph text)
            ctx.fillText('2026/12/31', 320, 1485);
            
            // Date of issue
            ctx.fillText('2023/11/14', 380, 1595);
            
            // Date printed (bottom)
            ctx.font = '44px Arial';
            ctx.fillText('2023/11/14', 365, 2205);
            
            // System code
            ctx.fillText('BENVEEN/ATC', 1090, 2205);
            
            // Control number (unique per person)
            ctx.font = '52px Arial';
            if (name.includes('Tasleem')) {
                ctx.fillText('297867', 1850, 2775);
            } else if (name.includes('Khunsha')) {
                ctx.fillText('297868', 1850, 2775);
            } else {
                ctx.fillText('297866', 1850, 2775);
            }
        }
        
        function downloadCanvas() {
            const link = document.createElement('a');
            link.download = 'DHA-802-permit.png';
            link.href = canvas.toDataURL();
            link.click();
        }
    </script>
</body>
</html>