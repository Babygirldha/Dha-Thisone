<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DHA-802 Exact Canvas Replica</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #2a2a2a;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            margin: 20px 0;
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        }
        .controls {
            margin: 20px 0;
        }
        button {
            padding: 12px 24px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 0 10px;
        }
        button:hover {
            background: #218838;
        }
        h1 {
            color: #fff;
            margin: 20px 0 10px 0;
        }
        p {
            color: #ccc;
        }
        .generated-images {
            margin-top: 30px;
            text-align: center;
        }
        .generated-images img {
            max-width: 600px;
            margin: 10px;
            border: 2px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>DHA-802 Permanent Residence Permit - Exact Replica</h1>
    <p>Canvas-based exact replica with proper guilloche patterns and text layout</p>
    
    <div class="controls">
        <button onclick="generatePRP('Muhammad Mohsin', 'AD0116281', '54877885001')">Muhammad Mohsin</button>
        <button onclick="generatePRP('Tasleem Mohsin', 'AUD115281', '54877885002')">Tasleem Mohsin</button>
        <button onclick="generatePRP('Khunsha', 'KV4122911', '54877885003')">Khunsha</button>
        <button onclick="downloadCanvas()">Download as Image</button>
    </div>
    
    <canvas id="prpCanvas" width="2100" height="2970"></canvas>
    
    <div class="generated-images">
        <h2>AI-Generated Replicas</h2>
        <img src="attached_assets/generated_images/Perfect_DHA-802_replica_d7876710.png" alt="Perfect DHA-802">
        <p>Latest AI-generated replica with guilloche patterns</p>
    </div>

    <script>
        const canvas = document.getElementById('prpCanvas');
        const ctx = canvas.getContext('2d');
        
        // Scale factor for high-quality rendering
        const scale = 10; // 10x for print quality
        canvas.style.width = '210mm';
        canvas.style.height = '297mm';
        
        function generatePRP(name, passport, permitNumber) {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Security paper background - seamless cream/beige
            ctx.fillStyle = '#FAF7F0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // THREE DISTINCT GUILLOCHE LAYERS
            drawFirstGuillocheLayer();   // Lightest background covering entire document
            drawSecondGuillocheLayer();   // Border pattern around edges
            drawThirdGuillocheLayer();    // Round/oval pattern in signature area
            
            // Draw coat of arms (positioned exactly at 14mm from left)
            drawCoatOfArms(140, 150); // 14mm * 10 scale
            
            // Horizontal line under header
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(500, 450);
            ctx.lineTo(1600, 450);
            ctx.stroke();
            
            // Header text - exact positioning
            ctx.fillStyle = '#000';
            ctx.font = '80px Arial';
            ctx.fillText('home affairs', 500, 250);
            
            ctx.font = '60px Arial';
            ctx.fillText('Department', 500, 320);
            ctx.fillText('Home Affairs', 500, 380);
            
            ctx.font = 'bold 60px Arial';
            ctx.fillText('REPUBLIC OF SOUTH AFRICA', 500, 440);
            
            // DHA-802 at top right (12mm from top)
            ctx.font = '80px Arial';
            ctx.fillText('DHA-802', 1800, 150);
            
            // Title
            ctx.font = 'bold 120px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('PERMANENT RESIDENCE PERMIT', 1050, 600);
            
            ctx.font = '60px Arial';
            ctx.fillText('SECTIONS 26 AND 27 OF ACT NO. 13 OF 2002', 1050, 670);
            
            // Form fields with exact underline positions
            ctx.textAlign = 'left';
            
            // PERMIT NUMBER at y=920mm (92mm * 10)
            ctx.font = 'bold 70px Arial';
            ctx.fillText('PERMIT NUMBER', 250, 920);
            drawUnderline(650, 930, 500);
            ctx.font = '60px Arial';
            ctx.fillText(permitNumber, 700, 920);
            
            // REFERENCE NO on same line
            ctx.font = 'bold 70px Arial';
            ctx.fillText('REFERENCE NO', 1200, 920);
            drawUnderline(1550, 930, 500);
            
            // Legal text
            ctx.font = '50px Arial';
            const legalText = 'In terms of the provisions of section 27(b) of the Immigration Act, 2002 (Act No. 13 of 2002),';
            ctx.fillText(legalText, 250, 1050);
            
            // Surname at y=1050mm (105mm * 10)
            ctx.font = 'bold 60px Arial';
            ctx.fillText('Surname', 250, 1150);
            drawUnderline(450, 1160, 1260);
            const [firstName, ...lastNames] = name.split(' ');
            ctx.font = '60px Arial';
            ctx.fillText(lastNames.join(' ').toUpperCase(), 500, 1145);
            
            // Maiden Surname at y=1130mm
            ctx.font = 'bold 60px Arial';
            ctx.fillText('Maiden Surname', 250, 1250);
            drawUnderline(600, 1260, 1260);
            
            // First Name(s) at y=1210mm
            ctx.fillText('First Name (s)', 250, 1350);
            drawUnderline(550, 1360, 1260);
            ctx.font = '60px Arial';
            ctx.fillText(firstName.toUpperCase(), 600, 1345);
            
            // Nationality
            ctx.font = 'bold 60px Arial';
            ctx.fillText('Nationality', 250, 1450);
            drawUnderline(450, 1460, 650);
            ctx.font = '60px Arial';
            ctx.fillText('PAKISTANI', 500, 1445);
            
            // Date of birth & Gender
            ctx.font = 'bold 60px Arial';
            ctx.fillText('Date of birth', 250, 1550);
            drawUnderline(500, 1560, 400);
            
            ctx.fillText('Gender', 1200, 1550);
            drawUnderline(1350, 1560, 350);
            ctx.font = '60px Arial';
            ctx.fillText('MALE', 1400, 1545);
            
            // Authorization paragraph text
            ctx.font = '48px Arial';
            const authText = [
                'has been authorised to enter the Republic of South Africa for the purpose of taking up permanent residence,',
                'or if he/she on the date of approval of application, already sojourns therein legally, to reside permanently.',
                'Unless the holder of this permit enters the Republic of South Africa for the purpose of permanent residence',
                'before or on ______________________ the permanent residence permit shall lapse.'
            ];
            let y = 1600;
            authText.forEach(line => {
                ctx.fillText(line, 140, y);
                y += 70;
            });
            
            // Date of issue
            ctx.font = 'bold 60px Arial';
            ctx.fillText('Date of issue', 250, 2100);
            drawUnderline(500, 2110, 400);
            ctx.font = '60px Arial';
            ctx.fillText('15/09/2025', 520, 2095);
            
            // Signature
            ctx.font = 'italic 80px Arial';
            ctx.fillText('Makholde', 250, 2300);
            
            ctx.font = 'bold 60px Arial';
            ctx.fillText('DIRECTOR-GENERAL', 250, 2400);
            ctx.fillText('DEPARTMENT OF HOME AFFAIRS', 250, 2450);
            
            // Right side - Surname and initials
            ctx.font = '60px Arial';
            ctx.fillText('Makholde LT', 1200, 2300);
            ctx.font = '50px Arial';
            ctx.fillText('Surname and initials', 1200, 2350);
            
            // Red stamp box on the right side
            ctx.strokeStyle = '#FF0000';
            ctx.lineWidth = 4;
            ctx.strokeRect(1400, 2100, 500, 350);
            ctx.strokeRect(1410, 2110, 480, 330); // Double border
            
            // Text inside stamp
            ctx.fillStyle = '#FF0000';
            ctx.font = 'bold 45px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('DEPARTMENT OF HOME AFFAIRS', 1650, 2180);
            ctx.font = '40px Arial';
            ctx.fillText('PRIVATE BAG X114', 1650, 2250);
            ctx.fillText('PRETORIA 0001', 1650, 2320);
            ctx.fillText('07', 1650, 2390);
            ctx.textAlign = 'left';
            ctx.fillStyle = '#000';
            
            // Date printed and Printed by - BELOW signature area
            ctx.font = 'bold 60px Arial';
            ctx.fillText('Date printed', 250, 2600);
            drawUnderline(450, 2610, 400);
            ctx.font = '60px Arial';
            ctx.fillText('15/09/2025', 470, 2595);
            
            ctx.font = 'bold 60px Arial';
            ctx.fillText('Printed by: (system code)', 900, 2600);
            drawUnderline(1250, 2610, 400);
            ctx.font = '60px Arial';
            ctx.fillText('CPT-RO-001', 1270, 2595);
            
            // Conditions section
            ctx.font = 'bold 70px Arial';
            ctx.fillText('Conditions', 250, 2700);
            
            ctx.font = '45px Arial';
            ctx.fillText('(i) This permit is issued once only and must be duly safeguarded.', 250, 2750);
            ctx.fillText('(ii) Permanent residents who are absent from the Republic for three years or longer may lose their right to permanent residence in', 250, 2800);
            ctx.fillText('    the Republic. A period of absence may only be interrupted by an admission and sojourn in the Republic.', 250, 2850);
            
            // Barcode at bottom left and Control Number at bottom right
            drawBarcode(250, 2900);
            ctx.font = 'bold 60px Arial';
            ctx.textAlign = 'right';
            ctx.fillText('Control Number', 1650, 2930);
            ctx.font = '80px Arial';
            ctx.fillText('No. A', 1850, 2930);
            ctx.textAlign = 'left';
        }
        
        // THREE GUILLOCHE LAYERS as per user specification
        function drawFirstGuillocheLayer() {
            // FIRST LAYER - Lightest background guilloche covering entire document
            ctx.save();
            ctx.globalAlpha = 0.08; // Very faint
            ctx.strokeStyle = '#D4C4A0';
            ctx.lineWidth = 0.5;
            
            // Create a mesh pattern across entire page
            for(let x = 0; x < canvas.width; x += 30) {
                for(let y = 0; y < canvas.height; y += 30) {
                    ctx.beginPath();
                    ctx.arc(x, y, 15, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }
            
            // Wavy lines across page
            for(let y = 0; y < canvas.height; y += 40) {
                ctx.beginPath();
                for(let x = 0; x < canvas.width; x += 5) {
                    const waveY = y + Math.sin(x * 0.02) * 10;
                    if(x === 0) ctx.moveTo(x, waveY);
                    else ctx.lineTo(x, waveY);
                }
                ctx.stroke();
            }
            ctx.restore();
        }
        
        function drawSecondGuillocheLayer() {
            // SECOND LAYER - Border guilloche pattern around edges
            ctx.save();
            ctx.globalAlpha = 0.12; // Slightly more visible
            ctx.strokeStyle = '#C8B898';
            ctx.lineWidth = 0.8;
            
            // Top border pattern
            for(let x = 0; x < canvas.width; x += 15) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.quadraticCurveTo(x + 7, 50, x + 15, 0);
                ctx.stroke();
            }
            
            // Bottom border pattern
            for(let x = 0; x < canvas.width; x += 15) {
                ctx.beginPath();
                ctx.moveTo(x, canvas.height);
                ctx.quadraticCurveTo(x + 7, canvas.height - 50, x + 15, canvas.height);
                ctx.stroke();
            }
            
            // Left border pattern
            for(let y = 0; y < canvas.height; y += 15) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.quadraticCurveTo(50, y + 7, 0, y + 15);
                ctx.stroke();
            }
            
            // Right border pattern  
            for(let y = 0; y < canvas.height; y += 15) {
                ctx.beginPath();
                ctx.moveTo(canvas.width, y);
                ctx.quadraticCurveTo(canvas.width - 50, y + 7, canvas.width, y + 15);
                ctx.stroke();
            }
            ctx.restore();
        }
        
        function drawThirdGuillocheLayer() {
            // THIRD LAYER - Round guilloche with oval center in signature area
            // Positioned between signature, surname/initials, date printed, printed by, and stamp
            ctx.save();
            ctx.globalAlpha = 0.18; // Most visible layer
            ctx.strokeStyle = '#BCA878';
            ctx.lineWidth = 1;
            
            // Center position - in the middle of signature area
            const centerX = 1050; // Middle of document
            const centerY = 2350; // Between signature and date printed
            
            // Draw oval center
            ctx.beginPath();
            ctx.ellipse(centerX, centerY, 150, 100, 0, 0, Math.PI * 2);
            ctx.stroke();
            
            // Draw circular guilloche radiating from oval
            for(let angle = 0; angle < 360; angle += 6) {
                const radians = angle * Math.PI / 180;
                ctx.beginPath();
                
                // Start from oval edge
                const startX = centerX + Math.cos(radians) * 150;
                const startY = centerY + Math.sin(radians) * 100;
                ctx.moveTo(startX, startY);
                
                // Create spiral pattern
                for(let r = 150; r < 400; r += 10) {
                    const spiralAngle = radians + (r - 150) * 0.01;
                    const x = centerX + Math.cos(spiralAngle) * r;
                    const y = centerY + Math.sin(spiralAngle) * (r * 0.67); // Maintain oval shape
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
            
            // Add concentric ovals around center
            for(let scale = 1.2; scale < 3; scale += 0.3) {
                ctx.beginPath();
                ctx.ellipse(centerX, centerY, 150 * scale, 100 * scale, 0, 0, Math.PI * 2);
                ctx.stroke();
            }
            ctx.restore();
        }
        
        
        function drawCoatOfArms(x, y) {
            // Sun at top
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(x + 125, y, 40, 0, Math.PI * 2);
            ctx.fill();
            
            // Sun rays
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 3;
            for(let i = 0; i < 12; i++) {
                const angle = i * 30 * Math.PI / 180;
                ctx.beginPath();
                ctx.moveTo(x + 125 + Math.cos(angle) * 45, y + Math.sin(angle) * 45);
                ctx.lineTo(x + 125 + Math.cos(angle) * 60, y + Math.sin(angle) * 60);
                ctx.stroke();
            }
            
            // Shield
            ctx.fillStyle = '#006642';
            ctx.fillRect(x + 80, y + 60, 90, 100);
            
            // Crossed spear and knobkierie
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 8;
            ctx.beginPath();
            ctx.moveTo(x + 50, y + 40);
            ctx.lineTo(x + 200, y + 190);
            ctx.moveTo(x + 200, y + 40);
            ctx.lineTo(x + 50, y + 190);
            ctx.stroke();
            
            // Zulu figures
            ctx.fillStyle = '#000';
            // Left figure
            ctx.beginPath();
            ctx.arc(x + 30, y + 100, 15, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillRect(x + 20, y + 115, 20, 40);
            
            // Right figure
            ctx.beginPath();
            ctx.arc(x + 220, y + 100, 15, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillRect(x + 210, y + 115, 20, 40);
        }
        
        function drawUnderline(x, y, width) {
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x + width, y);
            ctx.stroke();
        }
        
        function drawBarcode(x, y) {
            // Simulated barcode
            ctx.fillStyle = '#000';
            const barcodePattern = [1,0,1,1,0,1,0,0,1,1,1,0,1,0,1,0,0,1,1,0,1,1,1,0,0,1,0,1,1,0];
            for(let i = 0; i < barcodePattern.length; i++) {
                if(barcodePattern[i] === 1) {
                    ctx.fillRect(x + i * 8, y, 6, 50);
                }
            }
        }
        
        function downloadCanvas() {
            const link = document.createElement('a');
            link.download = 'DHA-802-PRP.png';
            link.href = canvas.toDataURL();
            link.click();
        }
        
        // Generate initial document
        generatePRP('Muhammad Mohsin', 'AD0116281', '54877885001');
    </script>
</body>
</html>