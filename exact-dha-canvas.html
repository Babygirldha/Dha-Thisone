<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DHA-802 Exact Canvas Replica</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #2a2a2a;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            margin: 20px 0;
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        }
        .controls {
            margin: 20px 0;
        }
        button {
            padding: 12px 24px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 0 10px;
        }
        button:hover {
            background: #218838;
        }
        h1 {
            color: #fff;
            margin: 20px 0 10px 0;
        }
        p {
            color: #ccc;
        }
        .generated-images {
            margin-top: 30px;
            text-align: center;
        }
        .generated-images img {
            max-width: 600px;
            margin: 10px;
            border: 2px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>DHA-802 Permanent Residence Permit - Exact Replica</h1>
    <p>Canvas-based exact replica with proper guilloche patterns and text layout</p>
    
    <div class="controls">
        <button onclick="generatePRP('Muhammad Mohsin', 'AD0116281', '54877885001')">Muhammad Mohsin</button>
        <button onclick="generatePRP('Tasleem Mohsin', 'AUD115281', '54877885002')">Tasleem Mohsin</button>
        <button onclick="generatePRP('Khunsha', 'KV4122911', '54877885003')">Khunsha</button>
        <button onclick="downloadCanvas()">Download as Image</button>
    </div>
    
    <canvas id="prpCanvas" width="2100" height="2970"></canvas>
    
    <div class="generated-images">
        <h2>AI-Generated Replicas</h2>
        <img src="attached_assets/generated_images/Perfect_DHA-802_replica_d7876710.png" alt="Perfect DHA-802">
        <p>Latest AI-generated replica with guilloche patterns</p>
    </div>

    <script>
        const canvas = document.getElementById('prpCanvas');
        const ctx = canvas.getContext('2d');
        
        // Scale factor for high-quality rendering
        const scale = 10; // 10x for print quality
        canvas.style.width = '210mm';
        canvas.style.height = '297mm';
        
        function generatePRP(name, passport, permitNumber) {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Security paper background - light cream like authentic document
            ctx.fillStyle = '#F8F5F0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // THREE DISTINCT GUILLOCHE LAYERS
            drawFirstGuillocheLayer();   // Lightest background covering entire document
            drawSecondGuillocheLayer();   // Border pattern around edges
            drawThirdGuillocheLayer();    // Round/oval pattern in signature area
            
            // Draw coat of arms (positioned exactly at 14mm from left)
            drawCoatOfArms(140, 150); // 14mm * 10 scale
            
            // Horizontal line under header
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(500, 450);
            ctx.lineTo(1600, 450);
            ctx.stroke();
            
            // Header text - exact positioning
            ctx.fillStyle = '#006642'; // Green for home affairs
            ctx.font = '75px Arial';
            ctx.fillText('home affairs', 500, 240);
            
            ctx.fillStyle = '#000';
            ctx.font = '55px Arial';
            ctx.fillText('Department', 500, 310);
            ctx.fillText('Home Affairs', 500, 365);
            
            ctx.font = 'bold 55px Arial';
            ctx.fillText('REPUBLIC OF SOUTH AFRICA', 500, 420);
            
            // DHA-802 at top right
            ctx.font = '70px Arial';
            ctx.fillText('DHA-802', 1820, 140);
            
            // Title
            ctx.font = 'bold 100px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('PERMANENT RESIDENCE PERMIT', 1050, 580);
            
            ctx.font = '55px Arial';
            ctx.fillText('SECTIONS 26 AND 27 OF ACT NO. 13 OF 2002', 1050, 640);
            
            // Form fields with exact underline positions
            ctx.textAlign = 'left';
            
            // PERMIT NUMBER field
            ctx.font = 'bold 60px Arial';
            ctx.fillText('PERMIT NUMBER', 250, 780);
            drawUnderline(600, 790, 700);
            ctx.font = '55px Arial';
            ctx.fillText('PRP361176/2023 DRN', 620, 775);
            
            // REFERENCE NO on same line
            ctx.font = 'bold 60px Arial';
            ctx.fillText('REFERENCE NO', 1350, 780);
            drawUnderline(1650, 790, 400);
            ctx.font = '55px Arial';
            ctx.fillText('PRP/909059', 1670, 775);
            
            // Legal text
            ctx.font = '48px Arial';
            const legalText = 'In terms of the provisions of section 27(b) of the Immigration Act, 2002 (Act No. 13 of 2002),';
            ctx.fillText(legalText, 250, 900);
            
            // Surname field
            ctx.font = 'bold 55px Arial';
            ctx.fillText('Surname', 250, 1000);
            drawUnderline(420, 1010, 1430);
            ctx.font = '55px Arial';
            ctx.fillText('MOLINA', 450, 995);
            
            // Maiden Surname field
            ctx.font = 'bold 55px Arial';
            ctx.fillText('Maiden Surname', 250, 1100);
            drawUnderline(550, 1110, 1300);
            
            // First Name(s) field
            ctx.font = 'bold 55px Arial';
            ctx.fillText('First Name (s)', 250, 1200);
            drawUnderline(500, 1210, 1350);
            ctx.font = '55px Arial';
            ctx.fillText('PIERRE - EDOUARD ADRIEN DENIS', 520, 1195);
            
            // Nationality field
            ctx.font = 'bold 55px Arial';
            ctx.fillText('Nationality', 250, 1300);
            drawUnderline(430, 1310, 770);
            ctx.font = '55px Arial';
            ctx.fillText('FRANCE', 460, 1295);
            
            // Date of birth & Gender
            ctx.font = 'bold 55px Arial';
            ctx.fillText('Date of birth', 250, 1400);
            drawUnderline(450, 1410, 450);
            ctx.font = '55px Arial';
            ctx.fillText('1983/05/21', 470, 1395);
            
            ctx.font = 'bold 55px Arial';
            ctx.fillText('Gender', 1000, 1400);
            drawUnderline(1150, 1410, 350);
            ctx.font = '55px Arial';
            ctx.fillText('MALE', 1200, 1395);
            
            // Authorization paragraph text
            ctx.font = '46px Arial';
            const authText = [
                'has been authorised to enter the Republic of South Africa for the purpose of taking up permanent residence, or if he/she on',
                'the date of approval of application, already sojourns therein legally, to reside permanently. Unless the holder of this permit',
                'enters the Republic of South Africa for the purpose of permanent residence before or on __________________',
                'before or on 2024/11/13, the permanent residence permit shall lapse.'
            ];
            let y = 1500;
            authText.forEach(line => {
                ctx.fillText(line, 140, y);
                y += 60;
            });
            
            // Date of issue
            ctx.font = 'bold 55px Arial';
            ctx.fillText('Date of issue', 250, 1850);
            drawUnderline(470, 1860, 350);
            ctx.font = '55px Arial';
            ctx.fillText('2023/11/14', 490, 1845);
            
            // Signature
            ctx.font = 'italic 70px Arial';
            ctx.fillText('Signature', 250, 2050);
            
            ctx.font = '50px Arial';
            ctx.fillText('DIRECTOR-GENERAL', 250, 2150);
            ctx.fillText('DEPARTMENT OF HOME AFFAIRS', 250, 2200);
            
            // Right side - Surname and initials
            ctx.font = 'italic 70px Arial';
            ctx.fillText('Signature', 1100, 2050);
            ctx.font = '55px Arial';
            ctx.fillText('Makholde LT', 1100, 2100);
            ctx.font = '50px Arial';
            ctx.fillText('Surname and initials', 1100, 2150);
            
            // Office stamp box on the right side
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.strokeRect(1550, 1850, 350, 380);
            
            // Red stamp text inside
            ctx.fillStyle = '#FF0000';
            ctx.font = 'bold 35px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('DEPARTMENT OF HOME AFFAIRS', 1725, 1920);
            ctx.font = '30px Arial';
            ctx.fillText('PRIVATE BAG X114', 1725, 1980);
            ctx.fillText('2023 -11- 1 4', 1725, 2040);
            ctx.fillText('PRETORIA 0001', 1725, 2100);
            ctx.fillText('07', 1725, 2160);
            ctx.textAlign = 'left';
            ctx.fillStyle = '#000';
            
            // Date printed and Printed by - BELOW signature area
            ctx.font = '55px Arial';
            ctx.fillText('Date printed', 250, 2350);
            drawUnderline(440, 2360, 350);
            ctx.font = '50px Arial';
            ctx.fillText('2023/11/14', 460, 2345);
            
            ctx.font = '55px Arial';
            ctx.fillText('Printed by: (system code)', 900, 2350);
            drawUnderline(1300, 2360, 400);
            ctx.font = '50px Arial';
            ctx.fillText('BENVEEN/ATC', 1320, 2345);
            
            // Conditions section
            ctx.font = 'bold 60px Arial';
            ctx.fillText('Conditions', 250, 2500);
            
            ctx.font = '42px Arial';
            ctx.fillText('(i)  This permit is issued once only and must be duly safeguarded.', 250, 2550);
            ctx.fillText('(ii) Permanent residents who are absent from the Republic for three years or longer may lose their right to permanent residence in', 250, 2600);
            ctx.fillText('     the Republic. A period of absence may only be interrupted by an admission and sojourn in the Republic.', 250, 2650);
            
            // BOTTOM ELEMENTS
            // Small barcode at bottom left corner
            drawSmallBarcode(100, 2850);
            
            // Control Number at bottom right side
            ctx.font = '50px Arial';
            ctx.textAlign = 'right';
            ctx.fillText('Control Number', 1950, 2880);
            ctx.font = '60px Arial';
            ctx.fillText('No. A  297866', 1950, 2920);
            
            // VERY SMALL Government Printing Works text - tiny and faint
            ctx.font = '10px Arial';
            ctx.fillStyle = 'rgba(0, 0, 0, 0.12)'; // Very faint
            ctx.textAlign = 'center';
            ctx.fillText('Government Printing Works Tel: 012 748 6000', 1050, 2950);
            
            // Reset text alignment and color
            ctx.textAlign = 'left';
            ctx.fillStyle = '#000';
        }
        
        // THREE GUILLOCHE LAYERS as per user specification
        function drawFirstGuillocheLayer() {
            // FIRST LAYER - Lightest background guilloche covering entire document
            ctx.save();
            ctx.globalAlpha = 0.08; // Very faint
            ctx.strokeStyle = '#D4C4A0';
            ctx.lineWidth = 0.5;
            
            // Create a mesh pattern across entire page
            for(let x = 0; x < canvas.width; x += 30) {
                for(let y = 0; y < canvas.height; y += 30) {
                    ctx.beginPath();
                    ctx.arc(x, y, 15, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }
            
            // Wavy lines across page
            for(let y = 0; y < canvas.height; y += 40) {
                ctx.beginPath();
                for(let x = 0; x < canvas.width; x += 5) {
                    const waveY = y + Math.sin(x * 0.02) * 10;
                    if(x === 0) ctx.moveTo(x, waveY);
                    else ctx.lineTo(x, waveY);
                }
                ctx.stroke();
            }
            ctx.restore();
        }
        
        function drawSecondGuillocheLayer() {
            // SECOND LAYER - Border guilloche pattern around edges
            ctx.save();
            ctx.globalAlpha = 0.12; // Slightly more visible
            ctx.strokeStyle = '#C8B898';
            ctx.lineWidth = 0.8;
            
            // Top border pattern
            for(let x = 0; x < canvas.width; x += 15) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.quadraticCurveTo(x + 7, 50, x + 15, 0);
                ctx.stroke();
            }
            
            // Bottom border pattern
            for(let x = 0; x < canvas.width; x += 15) {
                ctx.beginPath();
                ctx.moveTo(x, canvas.height);
                ctx.quadraticCurveTo(x + 7, canvas.height - 50, x + 15, canvas.height);
                ctx.stroke();
            }
            
            // Left border pattern
            for(let y = 0; y < canvas.height; y += 15) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.quadraticCurveTo(50, y + 7, 0, y + 15);
                ctx.stroke();
            }
            
            // Right border pattern  
            for(let y = 0; y < canvas.height; y += 15) {
                ctx.beginPath();
                ctx.moveTo(canvas.width, y);
                ctx.quadraticCurveTo(canvas.width - 50, y + 7, canvas.width, y + 15);
                ctx.stroke();
            }
            ctx.restore();
        }
        
        function drawThirdGuillocheLayer() {
            // THIRD LAYER - Round guilloche with oval center in signature area
            // Positioned between signature, surname/initials, date printed, printed by, and stamp
            ctx.save();
            ctx.globalAlpha = 0.18; // Most visible layer
            ctx.strokeStyle = '#BCA878';
            ctx.lineWidth = 1;
            
            // Center position - in the middle of signature area
            const centerX = 1050; // Middle of document
            const centerY = 2350; // Between signature and date printed
            
            // Draw oval center
            ctx.beginPath();
            ctx.ellipse(centerX, centerY, 150, 100, 0, 0, Math.PI * 2);
            ctx.stroke();
            
            // Draw circular guilloche radiating from oval
            for(let angle = 0; angle < 360; angle += 6) {
                const radians = angle * Math.PI / 180;
                ctx.beginPath();
                
                // Start from oval edge
                const startX = centerX + Math.cos(radians) * 150;
                const startY = centerY + Math.sin(radians) * 100;
                ctx.moveTo(startX, startY);
                
                // Create spiral pattern
                for(let r = 150; r < 400; r += 10) {
                    const spiralAngle = radians + (r - 150) * 0.01;
                    const x = centerX + Math.cos(spiralAngle) * r;
                    const y = centerY + Math.sin(spiralAngle) * (r * 0.67); // Maintain oval shape
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
            
            // Add concentric ovals around center
            for(let scale = 1.2; scale < 3; scale += 0.3) {
                ctx.beginPath();
                ctx.ellipse(centerX, centerY, 150 * scale, 100 * scale, 0, 0, Math.PI * 2);
                ctx.stroke();
            }
            ctx.restore();
        }
        
        
        function drawCoatOfArms(x, y) {
            // Sun at top
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(x + 125, y, 40, 0, Math.PI * 2);
            ctx.fill();
            
            // Sun rays
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 3;
            for(let i = 0; i < 12; i++) {
                const angle = i * 30 * Math.PI / 180;
                ctx.beginPath();
                ctx.moveTo(x + 125 + Math.cos(angle) * 45, y + Math.sin(angle) * 45);
                ctx.lineTo(x + 125 + Math.cos(angle) * 60, y + Math.sin(angle) * 60);
                ctx.stroke();
            }
            
            // Shield
            ctx.fillStyle = '#006642';
            ctx.fillRect(x + 80, y + 60, 90, 100);
            
            // Crossed spear and knobkierie
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 8;
            ctx.beginPath();
            ctx.moveTo(x + 50, y + 40);
            ctx.lineTo(x + 200, y + 190);
            ctx.moveTo(x + 200, y + 40);
            ctx.lineTo(x + 50, y + 190);
            ctx.stroke();
            
            // Zulu figures
            ctx.fillStyle = '#000';
            // Left figure
            ctx.beginPath();
            ctx.arc(x + 30, y + 100, 15, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillRect(x + 20, y + 115, 20, 40);
            
            // Right figure
            ctx.beginPath();
            ctx.arc(x + 220, y + 100, 15, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillRect(x + 210, y + 115, 20, 40);
        }
        
        function drawUnderline(x, y, width) {
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x + width, y);
            ctx.stroke();
        }
        
        function drawBarcode(x, y) {
            // Simulated barcode
            ctx.fillStyle = '#000';
            const barcodePattern = [1,0,1,1,0,1,0,0,1,1,1,0,1,0,1,0,0,1,1,0,1,1,1,0,0,1,0,1,1,0];
            for(let i = 0; i < barcodePattern.length; i++) {
                if(barcodePattern[i] === 1) {
                    ctx.fillRect(x + i * 8, y, 6, 50);
                }
            }
        }
        
        function drawSmallBarcode(x, y) {
            // Small barcode for bottom left corner
            ctx.fillStyle = '#000';
            const barcodePattern = [1,0,1,1,0,1,0,0,1,1,1,0,1,0,1,0,0,1,1,0];
            for(let i = 0; i < barcodePattern.length; i++) {
                if(barcodePattern[i] === 1) {
                    ctx.fillRect(x + i * 4, y, 3, 30); // Smaller dimensions
                }
            }
        }
        
        function downloadCanvas() {
            const link = document.createElement('a');
            link.download = 'DHA-802-PRP.png';
            link.href = canvas.toDataURL();
            link.click();
        }
        
        // Generate initial document
        generatePRP('Muhammad Mohsin', 'AD0116281', '54877885001');
    </script>
</body>
</html>